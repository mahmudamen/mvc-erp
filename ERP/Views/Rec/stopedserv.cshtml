@{ViewBag.Title = "قائمة الخدمات المتوقفة";}
<nav>
    <ul class="nav nav-justified nav-fixed-top">
        <li class="dropdown">
            <a herf="#" class="dropdown-toggle" role="button" data-toggle="dropdown">الأطباء <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href='@Url.Action("AddDoctor", "Rec")'>إضافة طبيب</a></li>
                <li class="divider"></li>
                <li><a href='@Url.Action("Doctors", "Rec")'>قائمة الأطباء</a></li>
                <li class="divider"></li>
                <li><a href='@Url.Action("DocDu", "Rec")'>حسابات الأطباء</a></li>
                <li class="divider"></li>
                <li><a href='@Url.Action("GetsDoctor", "Rec")'>أطباء متوقفين</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a herf="#" class="dropdown-toggle" role="button" data-toggle="dropdown">الخدمات <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href='@Url.Action("Serv", "Rec")'>قائمة الخدمات</a></li>
                <li class="divider"></li>
                <li><a href='@Url.Action("stopedserv", "Rec")'>خدمات متوقفة</a></li>
                <li class="divider"></li>
                <li><a href='@Url.Action("reportserv", "Rec")'>تقارير</a></li>
                <li class="divider"></li>
            </ul>
        </li>
        <li class="dropdown">
            <a herf="#" class="dropdown-toggle" role="button" data-toggle="dropdown">القسم الداخلي <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href='@Url.Action("GetRooms", "Rec")'>الغرف</a></li>
                <li><a href='@Url.Action("GstRoom", "Rec")'>غرف متوقفة</a></li>
            </ul>
        </li>
        <li><a href='@Url.Action("OprSetting", "Rec")'>العمليات</a></li>
        <li><a href='@Url.Action("DevSetting", "Rec")'>الأجهزة الطبية</a></li>
    </ul>
</nav>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">قائمة الخدمات المتوقفة</h3>
    </div>
    <div class="panel-body">
        <div class="row" style="padding:5px 5px" id="bcon">
            <button class="small btn-primary pull-left" id="ad" title="F8"><i class="glyphicon glyphicon-plus"></i></button><span class="pull-left">|</span>
            <button class="small btn-info pull-left" id="ed" title="F9"><i class="glyphicon glyphicon-edit"></i></button><span class="pull-left">|</span>
            <button class="small btn-warning pull-left" id="ritm"><i class="glyphicon glyphicon-refresh"></i></button><span class="pull-left">|</span>
        </div>
        <table id="example" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="text-center">كود</th>
                    <th class="text-center">اسم الخدمة</th>
                    <th class="text-center">سعر الخدمة</th>
                    <th class="text-center">م.ادارية</th>
                    <th class="text-center">اجمالي</th>
                    <th class="text-center"></th>
                    <th class="text-center">درجة الطبيب</th>
                    <th class="text-center">إقامة</th>
                    <th class="text-center">طبيعة الخدمة</th>
                    <th class="text-center"></th>
                    <th class="text-center"></th>
                    <th class="text-center">تعاقد</th>
                    <th class="text-center">المستخدم</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="modal fade" id="Edserv">
    <div class="modal-med">
        <div class="modal-content">
            <div class="modal-header">
                <label class="modal-title">تعديل خدمة</label>
            </div>
            <div class="modal-body">
                <input type="hidden" id="eidtup" />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label>اســــم الـخـدمـــة</label>
                            <input type="text" id="eservn" class="form-control" style="max-width:350px" maxlength="50" />
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label style="margin:0px 0px 0px 75px">سـعـر الـخـدمـة</label>
                            <input type="number" min="0" id="eservp" class="form-control text-center" style="max-width:100px" />
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label style="margin:0px 0px 0px 85px">قيمة مضافة</label>
                            <input type="number" min="0" id="eadval" class="form-control text-center" style="max-width:100px" />
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label style="margin:0px 0px 0px 71px">درجـــة الطبيـب</label>
                            @Html.DropDownList("dgr", (SelectList)ViewBag.dgr, "  -----اختر من القائمة-----  ", new { @class = "form-control text-left", @style = "max-width:200px;", id = "edg" })
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label style="margin:0px 0px 0px 73px">طبيعة الخدمة</label>
                            @Html.DropDownList("typ", (SelectList)ViewBag.typ, new { @class = "form-control text-left", @style = "max-width:200px;", id = "estyp" })
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label>إقامة</label>
                            <input id="eirom" type="checkbox" style="max-width:20px;margin:0px 10px 0px 0px" />
                        </div>
                        <div class="form-group" style="margin:0px 30px 0px 20px">
                            <label>تعاقد</label>
                            <input id="eccon" type="checkbox" style="max-width:20px;margin:0px 10px 0px 20px" checked="checked" />
                        </div>
                        <div class="form-group">
                            <label>تعمل/لاتعمل</label>
                            <input id="eisac" type="checkbox" style="max-width:20px;margin:0px 10px 0px 0px" />
                        </div>
                        <div class="form-group" style="margin:0px 10px 0px 10px">
                            <label>المستخدم</label>
                            <input type="password" id="ecbyn" class="form-control text-center" style="max-width:80px" maxlength="4" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" id="rsve" type="button" class="btn btn-sm btn-success">حفظ</a>
                <a type="button" href="javascript:;" class="btn btn-sm btn-danger" data-dismiss="modal">إغلاق</a>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/dts.js"></script>
    <script>
        $(document).ready(function () {
            $('#ritm').click(function () {
                var table = $("#example").DataTable();
                table.ajax.reload(null, false);
            })
            $("#Edserv").on('hidden.bs.modal', function () {
                var table = $("#example").DataTable();
                table.ajax.reload(null, false);
                $("#eservn,#eidtup,#ecbyn").val('');
                $("#eisac,#eccon").prop('checked', true);
                $("#eirom").prop('checked', true)
                $("#servp,#adval").val(0);
            });
            $('#rsve').click(function () {
                if ($('#eservn').val() == '') {
                    alert('يجب تحديد اسم الخدمة')
                    $('#eservn').focus();
                }
                else if ($('#ecbyn').val() == '') {
                    alert('يجب تحديد اسم المستخدم')
                    $('#ecbyn').focus();
                    $('#rsve').css('display', 'inline-block')
                }
                else {
                    $.ajax({
                        url: "@(Url.Action("ServUpdat", "Rec"))",
                        type: "GET",
                    contentType: "application/json; charset=utf-8",
                    data: { cby: $('#ecbyn').val(), id: $("#eidtup").val(), DocDegr: $('#edg').val(), servtyp: $("#estyp").val(), adval: $('#eadval').val(), ServName: $("#eservn").val(), ServVal: $("#eservp").val(), IsActive: $("#eisac").is(':checked'), rom: $("#eirom").is(':checked'), ccon: $("#eccon").is(':checked') },
                    dataType: "json",
                    success: function (data) {
                        if (data.Success) {
                            alert('تم تعديل الخدمة بنجاح')
                            $("#Edserv").modal("hide");
                            $('#rsve').css('display', 'inline-block')
                        }
                        else {
                            alert(data.Message)
                            $('#rsve').css('display', 'inline-block')
                        }
                    }
                });
            }
            });
            $(window).keydown(function (e) {
                if (event.which === 119) {
                    $('#ad').click();
                }
                else if (event.which === 120) {
                    $('#ed').click();
                }
            });
            var table = $('#example').DataTable({
                "bStateSave": true,
                fixedHeader: true, "ordering": false, "pageLength": 15, sAjaxSource: '/Haf/Rec/sfserv', lengthChange: false, dom: 'Bfrtip',
                buttons: [{
                    extend: 'print', title: function () { return 'مستشفي حفصة العوضي التخصصي' }, text: '<i class="glyphicon glyphicon-print"></i>',
                    exportOptions: { modifier: { page: 'current' }, columns: [0, 1, 2, 3, 4, 6, 7, 8, 11] },
                    customize: function (win) {
                        $(win.document.body).find('table').addClass('display').css('font-size', '12px');
                        $(win.document.body).find('h4').css('text-align', 'center');
                        $(win.document.body).find('h4').text('قائمة الخدمات المتوقفة');
                    }
                },
                ],
                columns: [
            { "data": "ID", "width": "5%", "sClass": "dt-center" },
            { "data": "ServName", "width": "30%" },
            { "data": "ServVal", "width": "10%", "sClass": "dt-center" },
            { "data": "AddVal", "width": "10%", "sClass": "dt-center" },
            { "data": "Totv", "width": "10%", "sClass": "dt-center" },
            { "data": "DocDegre", "visible": false },
            { "data": "Degr", "width": "15%", "sClass": "dt-center" },
            {
                "data": "Room", "sClass": "dt-center", "width": "5%",
                "render": function (val, type, row) {
                    return val == 0 ? "" : "غرف";
                }
            },
            { "data": "Servty", "sClass": "dt-center", "width": "15%" },
            { "data": "IsActive", "visible": false },
            { "data": "ServType", "visible": false },
            {
                "data": "CContr", "sClass": "dt-center", "width": "5%",
                "render": function (val, type, row) {
                    return val == 0 ? "" : "تعاقد";
                }
            },
            { "data": "Cbyn", "sClass": "dt-center", "width": "10%" },
                ]
            });
            table.buttons().container().appendTo('#bcon');
            $('#ed').click(function () {
                var table = $("#example").DataTable();
                if (table.cell('.selected', 0).data()) {
                    $("#eidtup").val(table.cell('.selected', 0).data());
                    $("#eservn").val(table.cell('.selected', 1).data());
                    $("#eservp").val(table.cell('.selected', 2).data());
                    $("#eadval").val(table.cell('.selected', 3).data());
                    $("#edg").val(table.cell('.selected', 5).data());
                    $("#estyp").val(table.cell('.selected', 10).data());
                    if (table.cell('.selected', 7).data())
                    { $("#eirom").prop('checked', true); }
                    else { $("#eirom").prop('checked', false); }
                    if (table.cell('.selected', 9).data())
                    { $("#eisac").prop('checked', true); }
                    else { $("#eisac").prop('checked', false); }
                    if (table.cell('.selected', 11).data())
                    { $("#eccon").prop('checked', true); }
                    else { $("#eccon").prop('checked', false); }
                    $('#Edserv').modal({ backdrop: false });
                }
                else { alert("قم بتحديد بند أولا") }
            });
            $('#example tbody').on('click', 'tr', function () {
                var table = $("#example").DataTable();
                table.$('tr.selected').removeClass('selected');
                $(this).closest('tr').addClass('selected')
            });
        });
    </script>
}