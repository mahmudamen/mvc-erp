@{ViewBag.Title = "المشروعات";}
<script language="javascript" type="text/javascript">
    function Pcount() {
        $.ajax({
            url: '/Erp/Pro/Pcount', cache: false, type: "POST", success: function (data) {
                $('#zpcount').text(parseFloat(data).toFixed(0))
            }
        }).then(function () {
            setTimeout(Pcount, 900000);
        });;
    }
    function Gent() {
        $.ajax({
            url: '/Erp/Pro/Tcount', cache: false, type: "POST", success: function (data) {
                $('#tcount').text(parseFloat(data).toFixed(0))
            }
        });
    }
    function fcount() {
        $.ajax({
            url: '/Erp/Pro/fcount', cache: false, type: "POST", success: function (data) {
                $('#fcount').text(parseFloat(data).toFixed(0))
            }
        });
    }
    function fixcount() {
        $.ajax({
            url: '/Erp/Pro/fixcount', cache: false, type: "POST", success: function (data) {
                $('#fxcount').text(parseFloat(data).toFixed(0))
            }
        });
    }
    function savcount() {
        $.ajax({
            url: '/Erp/Pro/savcount', cache: false, type: "POST", success: function (data) {
                $('#savcount').text(parseFloat(data).toFixed(0))
            }
        });
    }
</script>
<link href="~/Content/gritter/css/jquery.gritter.css" rel="stylesheet" />
<link href="~/Content/bootstrap-rtl.min.css"  rel="stylesheet"/>
<link href="~/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/Assets/style.min.css" rel="stylesheet" />
<link href="~/Assets/animate.css" rel="stylesheet" media="screen">
<br />
<input type="hidden" id="prd" value=@ViewBag.prd /><input type="hidden" id="cby" value=@HttpContext.Current.User.Identity.Name.Split('|')[1] />
<div class="modal fade" id="Mdexp">
    <div class="modal-med">
        <div class="modal-content">
            <div class="modal-header">
                <label class="modal-title"> قيمة المنصرف من المستخلص</label>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <input type="hidden" id="zvid" />
                            <label>اسم المشروع</label>
                            <input type="text" id="vname" class="form-control text-center" style="width:350px" readonly="readonly" />
                            <input type="hidden" id="vid" />
                        </div>
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>القيمة التقديرية</label>
                            <input type="number" id="vtotalval" class="form-control text-center" readonly="readonly" style="width:100px" />
                        </div>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>رقم المستخلص</label>
                            <input type="number" id="expnum" min="1" class="form-control text-center" style="width:100px" />
                        </div>
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>تاريخ المستخلص</label>
                            <input type="date" id="expdate" class="form-control text-center" style="width:150px" />
                        </div>
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>قيمة المستخلص</label>
                            <input type="number" id="expval" class="form-control text-center" style="width:150px" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" id="btnexpad" type="button" class="btn btn-sm btn-success">اضافة</a>
                <a type="button" href="javascript:;" class="btn btn-sm btn-danger" data-dismiss="modal">إغلاق</a>
            </div>
        </div>
    </div>
</div>
<div class="row">
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-red-darker" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-file-text-o fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="pcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span>الطرح</span>
                <div class="stats-number" id="pcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 40.5%;"></div>
                </div>
                <div class="stats-desc" id="xpcount"></div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-blue-darker" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-building fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="tcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span>اللجنة الفنية</span>
                <div class="stats-number" id="tcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 40.5%;"></div>
                </div>
                <div class="stats-desc" id="xpcount"></div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-aqua-darker" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-money fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="fcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span>اللجنة المالية</span>
                <div class="stats-number" id="fcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 40.5%;"></div>
                </div>
                <div class="stats-desc" id="xfcount"></div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-blue" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-suitcase fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="fcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span> اسناد المشروعات</span>
                <div class="stats-number" id="fxcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 40.5%;"></div>
                </div>
                <div class="stats-desc" id="xpcount"></div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-black-darker" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-archive fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="fcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span>حفظ المشروعات</span>
                <div class="stats-number" id="savcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 40.5%;"></div>
                </div>
                <div class="stats-desc" id="xsavcount"></div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="widget widget-stats bg-blue-darker" data-sortable-id="index-6">
                <div class="stats-icon stats-icon-lg"><i class="fa fa-line-chart fa-fw"></i></div>
                <a href="javascript:void(0);" class="panel-reload" style="color:#fff" onclick="fcount()"><i class="glyphicon glyphicon-refresh"></i></a>
                <span>مشروعات تحت التنفيذ</span>
                <div class="stats-number" id="pcount"></div>
                <div class="stats-progress progress">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <div class="stats-desc" id="xpcount"></div>
            </div>
        </div>
</div>
<hr />
<!-- begin col-4 -->
<div class="col-md-4">
    <div id="a-panal" class="panel panel-primary" data-sortable-id="index-6">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <div class="btn-group m-r-5 pull-left">
                    <button class="btn-group-sm btn-icon btn-circle btn-danger pull-left" title="Hidden Panel" id="p-remove"><i class="fa fa-times"></i></button>
                </div>
                <div class="btn-group m-r-5 pull-left">
                    <button class="btn-group-sm btn-icon btn-square btn-success pull-left" title="اضافة المنصرف من المستخلصات" id="p-addexp"><i class="fa fa-plus"></i></button>
                    <button class="btn-group-sm btn-icon btn-square btn-info pull-left" title="Expand Panel " id="ex"><i class="fa fa-expand"></i></button>
                    <button class="btn-group-sm btn-icon btn-square btn-warning pull-left" title="Repeat Data" id="add-sticky"><i class="fa fa-repeat"></i></button>          
                </div>

            </div>
            <h4 class="panel-title">مشروعات تحت التنفيذ</h4>
        </div>
        <div class="panel-body p-t-0" id="pingo" style="display:none ;font-size:12px">
            <table id="tbprolist"  class="table table-valign-middle m-b-0 pull-right">
                <thead style="background-color:Background !important">
                    <tr>
                        <th>رقم</th>
                        <th class="text-center">اسم المشروع</th>
                        <th class="text-center">مرحلة </th>
                        <th class="text-center">المنصرف </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td ></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="b-panal" class="panel panel-inverse" data-sortable-id="ui-widget-4">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" id="b-ex" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" id="b-reload" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger " id="b-remove" data-click="panel-remove"><i class="fa fa-times"></i></a>
            </div>
            <div class="progress progress-striped progress-sm active pull-left m-t-5">
                <div class="progress-bar progress-bar-success" style="width: 40%" min="0" max="100" value="0">40%</div>
            </div>
            <h4 class="panel-title">حفظ المشروعات</h4>
        </div>
        <div class="panel-body" id="b-pingo" style="display:none;font-size:9PX">
            <table id="tbprofixlist" class="table table-valign-middle m-b-0 pull-right">
                <thead>
                    <tr>
                        <th>رقم</th>
                        <th class="text-center">اسم المشروع</th>
                        <th class="text-center">مرحلة </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="col-md-8">
    <div id="i-panal" style="display:none" class="panel panel-primary" data-sortable-id="index-6">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" id="i-ex" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" id="i-add-sticky" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger " id="i-remove" data-click="panel-remove"><i class="fa fa-times"></i></a>
            </div>
            <h4 class="panel-title">ارشيف</h4>
        </div>
        <div class="panel-body p-t-0" id="img-pingo" style="display:none ;font-size:9px">
            <div class="row">
                <div class="col-md-6 col-sm-6">
                    <table id="tbgallery" class="table table-valign-middle m-b-0 pull-right">
                        <thead>
                            <tr>
                                <th></th>
                                <th class="text-center">اسم المشروع</th>
                                <th class="text-center">مستند </th>
                                <th class="text-center">ملف </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6 col-sm-6">
                        <div id="grid-gallery" class="grid-gallery">
                            <section class="grid-wrap">
                                <ul class="grid">
                                    <li class="grid-sizer" ></li><!-- for Masonry column width -->
                                    <li style="width:40%">
                                        <figure style="padding:1px">
                                            <a id="linko" href="">
                                                <img id="targetImg" src=" " alt="صورة للإرشيف " />
                                            </a>
                                            <figcaption>
                                                <label id="namefiles"></label>
                                            </figcaption>
                                        </figure>
                                    </li>
                                </ul>
                            </section><!-- // grid-wrap -->
                      </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="zpcount" />
<!-- end col-4 -->
<link href="~/Content/google-grid.css" rel="stylesheet" />
<link href="~/Content/select2.css" rel="stylesheet" />
@section scripts{
<script src="~/Scripts/jquery-ui.min.js"></script>
<script src="~/Scripts/apps.min.js"></script>
    <script src="~/Content/gritter/js/jquery.gritter.js"></script>
    <script src="~/Scripts/jquery.slimscroll.min.js"></script>
    <script src="~/Scripts/select2.full.min.js"></script>
    <script src="~/Scripts/dts.js"></script>
    <script>
        $(document).ready(function () {
            App.init();
            var Notification = function () { "use strict"; return { init: function () { handleGritterNotification() } } }()
            Notification.init()
            Pcount();
            Gent()
            fcount()
            savcount()
            fixcount()
            var m = '70';
            m = parseFloat(m) + 15
            var h = m +'%'
            $(".progress-bar").attr("style", 'width:'+h)
            $('#ex').click(function () {
                $('#pingo').toggle()
                $('#b-pingo').hide()
                var tbtprov = $("#tbprolist").DataTable();
                tbtprov.$('tr.selected').removeClass('selected');
                tbtprov.clear();
                tbtprov.draw();
                tbtprov.ajax.url('/ERP/Pro/tbprostate').load()
            });
            $('#b-ex').click(function () {
                $('#b-pingo').toggle()
                $('#pingo').hide()
                var tbtprov = $("#tbprofixlist").DataTable();
                tbtprov.$('tr.selected').removeClass('selected');
                tbtprov.clear();
                tbtprov.draw();
                tbtprov.ajax.url('/ERP/Pro/tbprofixstate').load()
            });
            $('#i-ex').click(function () {
                $('#img-pingo').toggle()
            });
        });
        $(document).ready(function () {
            $.ajax({
                url: '/Erp/Pro/Pcount', cache: false, type: "POST", success: function (data) {
                    $('#zpcount').text(parseFloat(data).toFixed(0))
               
            var m = data
            var incrementJ = $('#pcount').text();

            $({ numberValue: incrementJ }).animate({
                numberValue: m
            }, {
                duration: 2000,
                easing: 'linear',
                step: function () {
                    $('#pcount').text(Math.ceil(this.numberValue));
                },
                done: function () {
                    $('#pcount').text(Math.ceil(this.numberValue));
                }
            });
                }
            })
        });
        $('#p-reload').click(function () {
            var tbtprov = $("#tbprolist").DataTable();
            tbtprov.$('tr.selected').removeClass('selected');
            tbtprov.clear();
            tbtprov.draw();
            tbtprov.ajax.url('/ERP/Pro/tbprostate').load()
        });
        $('#i-add-sticky').click(function () {
            var tbtprov = $("#tbgallery").DataTable();
            tbtprov.$('tr.selected').removeClass('selected');
            tbtprov.clear();
            tbtprov.draw();
            tbtprov.ajax.url('/ERP/Pro/tbgalary').load()
        });
        $('#i-ex').click(function () {
            var tbtprov = $("#tbgallery").DataTable();
            tbtprov.$('tr.selected').removeClass('selected');
            tbtprov.clear();
            tbtprov.draw();
            tbtprov.ajax.url('/ERP/Pro/tbgalary').load()
        });
        $('#p-addexp').click(function () {
            var table = $('#tbprolist').DataTable();
            $(this).closest('tr').addClass('selected');
            var vid = table.cell('.selected', 0).data();
            if (vid == null) {
                alert('اختار عملية لإضافة المنصرف')
            } else {
                $('#vid').val(vid);
                $('#vname').val(table.cell('.selected', 1).data());
                $('#Mdexp').modal({ backdrop: false });
            }
            
        });
        $('#b-reload').click(function () {
            var tbtprov = $("#tbprofixlist").DataTable();
            tbtprov.$('tr.selected').removeClass('selected');
            tbtprov.clear();
            tbtprov.draw();
            tbtprov.ajax.url('/ERP/Pro/tbprofixstate').load()
        });
        $('#p-remove').click(function () {
            $('#a-panal').hide()
        });
        $('#i-remove').click(function () {
            $('#i-panal').hide()
        });
        $('#b-remove').click(function () {
            $('#b-panal').hide()
        });
        var table = $('#tbprolist').DataTable({
            cache: true,
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbprostate', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "ProName", "sClass": "dt-center", "width": "20%" },
        { "data": "PostedName", "sClass": "dt-center", "width": "1%" },
        { "data": "ExpForNow", "sClass": "dt-center", "width": "1%" }
            ]
        });
        $('#tbprolist tbody').on('click', 'tr', function () {
            var table = $('#tbprolist').DataTable();
            table.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
        });
        var table = $('#tbprofixlist').DataTable({
            cache: true,
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbprofixstate', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "ProName", "sClass": "dt-center", "width": "20%" },
        { "data": "PostedName", "sClass": "dt-center", "width": "1%" }
            ]
        });
        var table = $('#tbgallery').DataTable({
            cache: true,
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbgalary', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "ProName", "sClass": "dt-center", "width": "20%" },
        { "data": "ReNamePic", "sClass": "dt-center", "width": "1%" },
        { "data": "Photo", "sClass": "dt-center", "width": "1%" }
            ]
        });
        $('#btnexpad').click(function () {
            $.ajax({
                url: "@(Url.Action("addexp", "Pro"))",
                type: "GET",
            contentType: "application/json; charset=utf-8",
            data: { id: $('#vid').val(), expnum: $('#expnum').val(), expdate: $('#expdate').val(), expval: $('#expval').val(), cby: $('#cby').val() },
            dataType: "json",
            success: function (data) {
                if (data.Success) {
                    alert(data.Message)
                    var tbtprov = $("#tbprolist").DataTable();
                    tbtprov.$('tr.selected').removeClass('selected');
                    tbtprov.clear();
                    tbtprov.draw();
                    tbtprov.ajax.url('/ERP/Pro/tbprostate').load()
                    $('#Mdexp').modal("hide");
                }
                else {
                    alert(data.Message)
                }
            }
                
            })
        });
        $('#tbgallery tbody').on('click', 'tr', function () {
            var table = $("#tbgallery").DataTable();
            table.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
            var vid = table.cell('.selected', 0).data()
            $.ajax({
                url: '/ERP/Pro/imgdef',
                type: "GET",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: {id : vid},
                success: function (data) {
                    //   $('#targetImg').append("<img src='/Erp/Img/" + data.resulte + "'><br>");
                    $('#targetImg').attr('src', '/Erp/Img/' + data.resulte)
                    $('#namefiles').text(data.resulte)
                    $('#linko').attr('href', '/Erp/Img/' + data.resulte)
                    // $('#FileUpload1').empty()

                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        })
        var handleGritterNotification = function () {
            $("#add-maxx").click(function () {
                $.gritter.add({
                    title: "عنوان",
                    text: "مضمون  ",
                    sticky: false, image: "/Erp/Img/155.jpg",
                    before_open: function () {
                        if ($(".gritter-item-wrapper").length === 3)
                        { return false }
                    }
                }); return false
            });
        }
    </script>
}