@{ViewBag.Title = " انواع المشاريع";}
<script language="javascript" type="text/javascript">
    function empcountfuc() {
        $.ajax({
            url: '/ERP/HR/empcountfuc', cache: false, type: "POST", success: function (data) {
                $('#empcount').text(parseFloat(data).toFixed(0))
            }
        });
    }
    function ORDlst() {
        $.ajax({
            url: '/ERP/Casher/ORDlst', cache: false, type: "POST", success: function (data) {
                $('#lastname').val(data)
            }
        });
    }
    function ORDlstnum() {
        $.ajax({
            url: '/ERP/Casher/ORDlstnum', cache: false, type: "POST", success: function (data) {
                $('#orderfk').val(data)
            }
        });
    }
    function Ordpk() {
        $.ajax({
            url: '/ERP/Casher/Ordpk', cache: false, type: "POST", success: function (data) {
                $('#orderpk').val(data)
            }
        });
    }
    function Totfuc() {
        $.ajax({
            url: '/ERP/Casher/Totfuc?id=' + parseInt($('#last').text()), cache: false, type: "POST", success: function (data) {
                $('#Totfuc').text(parseFloat(data).toFixed(0))
            }
        });
    }
</script>
<input type="hidden" id="prd" value=@ViewBag.prd /><input type="hidden" id="cby" value=@HttpContext.Current.User.Identity.Name.Split('|')[1] />

<div class="modal fade" id="Mdtpro">
    <div class="modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <label class="modal-title">إضافة  نوع رئيسي جديد</label>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>نوع المشروع</label>
                            <input type="text" id="tname" class="form-control text-center" style="width:200px" autofocus="autofocus" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" id="adtpro" type="button" class="btn btn-sm btn-success">اضافة</a>
                <a type="button" href="javascript:;" class="btn btn-sm btn-danger" data-dismiss="modal">إغلاق</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="Mdkpro">
    <div class="modal-sm" style="width:500px !important">
        <div class="modal-content">
            <div class="modal-header">
                <label class="modal-title">إضافة نوع فرعي جديد</label>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label> رقم المشروع </label>
                            <input type="text" id="idt" class="form-control text-center" readonly="readonly" style="width:100px" />
                        </div>
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label> المشروع الرئيسي </label>
                            <input type="text" id="tfkname" class="form-control text-center" readonly="readonly" style="width:180px" />
                        </div>
                    </div>
                    </div>
                <br />
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label> نوع المشروع </label>
                            <input type="text" id="kname" class="form-control text-center" style="width:180px" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" id="adkproj" type="button" class="btn btn-sm btn-success">اضافة</a>
                <a type="button" href="javascript:;" class="btn btn-sm btn-danger" data-dismiss="modal">إغلاق</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="Mdpur">
    <div class="modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <label class="modal-title">إضافة طريقة اسناد جديد</label>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-inline ls_form">
                        <div class="form-group" style="margin:0px 5px 0px 5px">
                            <label>اسم طريقة الاسناد</label>
                            <input type="text" id="purname" class="form-control text-center" style="width:200px" autofocus="autofocus" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:;" id="adpurtype" type="button" class="btn btn-sm btn-success">اضافة</a>
                <a type="button" href="javascript:;" class="btn btn-sm btn-danger" data-dismiss="modal">إغلاق</a>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3" style="padding: 12px;">
        <div class="panel panel-primary" style="margin-bottom:5px">
            <div class="panel-heading" style="padding: 5px 5px;">
                <label class="panel-title" >انواع المشاريع الرئيسية</label>
                <button class="btn btn-xs btn-success pull-left" title="إضافة نوع رئيسي جديد " id="btnadtpro"><i class="glyphicon glyphicon-plus-sign"></i></button>
            </div>
            <div class="panel-body" style="max-height:360px; min-height:300px; padding:10px">
                <table id="tbtpro" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-center">نوع رئيسي </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <div class="col-md-3" style="padding: 12px;">
        <div class="panel panel-primary" style="margin-bottom:5px">
            <div class="panel-heading" style="padding: 10px 10px;">
                <label class="panel-title">الانواع المشاريع الفرعية</label>
                <button class="btn btn-xs btn-success pull-left" title="إضافة نوع فرعي جديدة " id="btnadkpro"><i class="glyphicon glyphicon-plus-sign"></i></button>
            </div>
            <div class="panel-body" style="max-height:360px; min-height:300px; padding:10px">
                <table id="tbtbKPro" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-center"> نوع فرعي</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-3" style="padding: 12px;">
        <div class="panel panel-primary" style="margin-bottom:5px">
            <div class="panel-heading" style="padding: 10px 10px;">
                <label class="panel-title">انواع الاسناد للمشروعات</label>
                <button class="btn btn-xs btn-success pull-left" title="إضافة طريقة طرح " id="btnadpur"><i class="glyphicon glyphicon-plus-sign"></i></button>
            </div>
            <div class="panel-body" style="max-height:360px; min-height:300px; padding:10px">
                <table id="tbpurtype" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-center"> طريقة الطرح</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-3" style="padding: 12px;">
        <div class="panel panel-primary" style="margin-bottom:5px">
            <div class="panel-heading" style="padding: 10px 10px;">
                <label class="panel-title">ارشيف المشروعات</label>
                <button class="btn btn-xs btn-success pull-left" title="اضافة معرض صور " id="btnadpur"><i class="glyphicon glyphicon-plus-sign"></i></button>
            </div>
            <div class="panel-body" style="max-height:360px; min-height:300px; padding:10px">
                <table id="tbGallery" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-center"> معارض الصور</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/Scripts/dts.js"></script>
    <script>
        $(document).ready(function () {
        });
        $('#example tbody').on('click', 'tr', function () {
            var table = $("#example").DataTable();
            table.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
        });
        // var  table
        var table = $('#tbtpro').DataTable({
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbTProdef', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            dom: 'Bfrtip',
            buttons: [{
                extend: 'print', title: function () { return 'جهاز مدينة أسوان الجديدة' }, text: '<i class="glyphicon glyphicon-print"></i>',
                exportOptions: { modifier: { page: 'current' } }, scrollY: '120px', scrollCollapse: true, bPaginate: false,
                customize: function (win) {
                    $(win.document.body).find('table').addClass('display').css('font-size', '12px');
                    $(win.document.body).find('h4').css('text-align', 'center');
                    $(win.document.body).find('h4').text('قائمة المشاريع الرئيسية');
                }
            },
            ],
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "TName", "sClass": "dt-center", "width": "30%" }
            ]
        });
        var table = $('#tbtbKPro').DataTable({
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbKProdef', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            dom: 'Bfrtip',
            buttons: [{
                extend: 'print', title: function () { return 'جهاز مدينة أسوان الجديدة' }, text: '<i class="glyphicon glyphicon-print"></i>',
                exportOptions: { modifier: { page: 'current' } }, scrollY: '120px', scrollCollapse: true, bPaginate: false,
                customize: function (win) {
                    $(win.document.body).find('table').addClass('display').css('font-size', '12px');
                    $(win.document.body).find('h4').css('text-align', 'center');
                    $(win.document.body).find('h4').text('قائمة المشاريع الفرعية');
                }
            },
            ],
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "KName", "sClass": "dt-center", "width": "30%" }
            ]
        });
        var table = $('#tbpurtype').DataTable({
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbpurdef', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            dom: 'Bfrtip',
            buttons: [{
                extend: 'print', title: function () { return 'جهاز مدينة أسوان الجديدة' }, text: '<i class="glyphicon glyphicon-print"></i>',
                exportOptions: { modifier: { page: 'current' } }, scrollY: '120px', scrollCollapse: true, bPaginate: false,
                customize: function (win) {
                    $(win.document.body).find('table').addClass('display').css('font-size', '12px');
                    $(win.document.body).find('h4').css('text-align', 'center');
                    $(win.document.body).find('h4').text('انواع الاسناد للمشروعات');
                }
            },
            ],
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "PurName", "sClass": "dt-center", "width": "30%" }
            ]
        });
        var table = $('#tbGallery').DataTable({
            bProcessing: false, sAjaxSource: '/ERP/Pro/tbGallery', bFilter: false, bInfo: false, lengthChange: false, scrollY: '200px', scrollCollapse: false, bPaginate: false,
            dom: 'Bfrtip',
            buttons: [{
                extend: 'print', title: function () { return 'جهاز مدينة أسوان الجديدة' }, text: '<i class="glyphicon glyphicon-print"></i>',
                exportOptions: { modifier: { page: 'current' } }, scrollY: '120px', scrollCollapse: true, bPaginate: false,
                customize: function (win) {
                    $(win.document.body).find('table').addClass('display').css('font-size', '12px');
                    $(win.document.body).find('h4').css('text-align', 'center');
                    $(win.document.body).find('h4').text('ارشيف الصور');
                }
            },
            ],
            columns: [
        { "data": "ID", "visible": false, "bSearchable": false },
        { "data": "GallaryName", "sClass": "dt-center", "width": "30%" },
        { "data": "Count", "sClass": "dt-center", "width": "1%" }
            ]
        });
            // select  function tbcpy
        $('#tbtpro tbody').on('click', 'tr', function () {
            var tbSysv = $("#tbtpro").DataTable();
            tbSysv.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
            var vid = tbSysv.cell('.selected', 0).data()
            var table = $("#tbtbKPro").DataTable();
            table.$('tr.selected').removeClass('selected');
            table.clear();
            table.draw();
            table.ajax.url('/Erp/Pro/tbKProdef?id=' + vid).load()
        });
        // select  function tbpurtype
        $('#tbpurtype tbody').on('click', 'tr', function () {
            var tbSysv = $("#tbpurtype").DataTable();
            tbSysv.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
        });
        $('#tbGallery tbody').on('click', 'tr', function () {
            var tbSysv = $("#tbGallery").DataTable();
            tbSysv.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
        });
            // select  function tbactivity
        $('#tbtbKPro tbody').on('click', 'tr', function () {
            var tbSysv = $("#tbtbKPro").DataTable();
            tbSysv.$('tr.selected').removeClass('selected');
            $(this).closest('tr').addClass('selected');
        });
        $('#btnadtpro').click(function () {
            $('#Mdtpro').modal({ backdrop: false });
        });
        $('#btnadpur').click(function () {
            $('#Mdpur').modal({ backdrop: false });
        });
        $('#btnadkpro').click(function () {
            var table = $("#tbtpro").DataTable();
            //table.$('tr.selected').removeClass('selected');
            var m = table.cell('.selected', 0).data()
            if (m != null) {
                $("#idt").val(table.cell('.selected', 0).data())
                $("#tfkname").val(table.cell('.selected', 1).data())
                $('#Mdkpro').modal({ backdrop: false });
            } else {
                alert("من فضلك تأكد من اختيار نوع رئيسي أولاً ..!")
            };
            
        });
        $('#adtpro').click(function () {
            $.ajax({
                url: "@(Url.Action("addtpro", "Pro"))",
                type: "GET",
            contentType: "application/json; charset=utf-8",
            data: { tname: $('#tname').val(), cby: $('#cby').val() },
            dataType: "json",
            success: function (data) {
                if (data.Success) {
                    alert(data.Message)
                    var tbtprov = $("#tbtpro").DataTable();
                    tbtprov.$('tr.selected').removeClass('selected');
                    tbtprov.clear();
                    tbtprov.draw();
                    tbtprov.ajax.url('/ERP/Pro/tbTProdef').load()
                    $('#Mdtpro').modal("hide");
                }
                else {
                    alert(data.Message)
                }
            }
        });
        });
        $('#adpurtype').click(function () {
            $.ajax({
                url: "@(Url.Action("adnewpurtype", "Pro"))",
                type: "GET",
            contentType: "application/json; charset=utf-8",
            data: { purName: $('#purname').val(), cby: $('#cby').val() },
            dataType: "json",
            success: function (data) {
                if (data.Success) {
                    alert(data.Message)
                    var tbpurtypev = $("#tbpurtype").DataTable();
                    tbpurtypev.$('tr.selected').removeClass('selected');
                    tbpurtypev.clear();
                    tbpurtypev.draw();
                    tbpurtypev.ajax.url('/ERP/Pro/tbpurdef').load()
                    $('#Mdpur').modal("hide");
                }
                else {
                    alert(data.Message)
                }
            }
        });
        });
        $('#adkproj').click(function () {
            $.ajax({
                url: "@(Url.Action("addkproj", "Pro"))",
                type: "GET",
            contentType: "application/json; charset=utf-8",
            data: { id: $('#idt').val(), kname: $('#kname').val(), cby: $('#cby').val() },
            dataType: "json",
            success: function (data) {
                if (data.Success) {
                    alert(data.Message)
                    $('#Mdkpro').modal("hide");
                    var tbtbKProv = $("#tbtbKPro").DataTable();
                    tbtbKProv.$('tr.selected').removeClass('selected');
                    tbtbKProv.clear();
                    tbtbKProv.draw();
                    tbtbKProv.ajax.url('/ERP/Pro/tbKProdef?id=' + $('#idt').val()).load()
                    
                }
                else {
                    alert(data.Message)
                }
            }
        });
        });
    </script>
}